---
name: "semgrep-audit"
description: "使用 Semgrep MCP 工具进行代码审计，检查MISRA C规范和内存泄露。当用户要求进行代码检查、审计或符合MISRA标准时调用。"
---

# Semgrep 智能代码审查 (Semgrep Code Audit Skill)

此技能用于指导 Agent 使用 Semgrep MCP 工具对指定文件进行代码审计，重点关注 MISRA C 规范合规性和内存泄露风险。

## 核心职责

1. **Semgrep 扫描**: 使用 Semgrep MCP 工具检查制定的代码文件。
2. **语言要求**: 所有输出和文档必须使用**中文**。

## 执行流程

当此技能被调用时，Agent 必须严格遵循以下步骤：

### 第一步：初始化任务清单 (TODO List)

1. **分析需求**: 确定需要扫描的文件范围（用户指定或全量扫描）。
2. **创建任务清单**。清单应包含以下步骤:
   - [ ] 制定扫描策略 (MISRA C 规则集, 内存泄露规则)
   - [ ] 对目标文件执行 Semgrep 扫描
   - [ ] 分析扫描结果
   - [ ] 生成审计报告 (包含修复建议，要求中文)
   - [ ] 按照审计报告修复代码

### 第二步：执行与状态更新

**执行操作**: 调用相应的工具（如 `RunCommand` 运行 semgrep，`Read` 读取文件等）。

### 第三步：Semgrep 扫描指南

- **规则集**: 优先查找和使用现有的 MISRA C 规则集 (如 `p/misra-c-2012`) 和内存安全规则 (如 `p/security-audit`, `p/memory`).
- **结果分析**: 仔细阅读 Semgrep 的输出，区分误报和真实问题。

### 第四步：报告与结束

- 在所有检查完成后，向用户提供一份总结报告。

### 第五步：根据审计报告修复代码

- 根据审计报告中的修复建议，对代码进行修复。
